{% extends 'base.html' %}
{% load static %}
{% block title %}Shop - Yarned with Love{% endblock %}

{% block content %}
<!-- MOBILE-FIRST "POCKET BOUTIQUE" THEME START üì±üéÄ -->
<meta name="theme-color" content="#ffdae0">

<style>
    /* --- CORE VARIABLES --- */
    :root {
        --app-bg: #ffdae0;
        /* User's Pink */
        --card-bg: #ffffff;
        --text-main: #2d2d2d;
        --text-muted: #666666;
        --primary: #d46a7e;
        /* Deep Rose */
        --accent: #ff8fa3;
        /* Pop Pink */
        --radius-lg: 24px;
        --radius-md: 16px;
        --radius-sm: 12px;
        --shadow-soft: 0 10px 40px -10px rgba(212, 106, 126, 0.15);
        --shadow-popped: 0 20px 40px -10px rgba(212, 106, 126, 0.3);
    }

    /* --- RESET & TYPOGRAPHY --- */
    body {
        background-color: var(--app-bg) !important;
        font-family: 'Plus Jakarta Sans', sans-serif;
        padding-bottom: 80px;
        /* Space for Bottom Nav */
    }

    a {
        text-decoration: none;
        color: inherit;
    }

    /* --- UI: APP HEADER (Mobile Top) --- */
    .app-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgba(255, 218, 224, 0.9);
        backdrop-filter: blur(10px);
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .app-logo {
        font-family: 'Playfair Display', serif;
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--text-main);
    }

    .app-actions {
        display: flex;
        gap: 1rem;
        font-size: 1.5rem;
    }

    /* --- UI: STORY CIRCLES (Categories) --- */
    .stories-container {
        padding: 1rem 0 1.5rem 1.5rem;
        overflow-x: auto;
        white-space: nowrap;
        -ms-overflow-style: none;
        /* Hide scrollbar IE/Edge */
        scrollbar-width: none;
        /* Hide scrollbar Firefox */
    }

    .stories-container::-webkit-scrollbar {
        display: none;
    }

    .story-item {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        margin-right: 1.2rem;
        cursor: pointer;
    }

    .story-ring {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        padding: 3px;
        background: linear-gradient(45deg, #ff9a9e, #fad0c4);
        /* Ring Gradient */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease;
    }

    .story-circle {
        width: 100%;
        height: 100%;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        border: 2px solid white;
    }

    .story-label {
        margin-top: 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-main);
    }

    .story-item:active .story-ring {
        transform: scale(0.95);
    }

    /* --- UI: HERO CARD (Tinder-style) --- */
    .hero-card-wrapper {
        padding: 0 1.5rem;
        margin-bottom: 2rem;
    }

    .hero-card {
        background: linear-gradient(135deg, #FFF0F5, #FFFFFF);
        border-radius: var(--radius-lg);
        padding: 2rem;
        text-align: center;
        box-shadow: var(--shadow-soft);
        position: relative;
        overflow: hidden;
    }

    .hero-decoration {
        position: absolute;
        top: -20px;
        right: -20px;
        font-size: 8rem;
        opacity: 0.1;
        transform: rotate(15deg);
    }

    .hero-title {
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary);
        line-height: 1.2;
        margin-bottom: 0.5rem;
    }

    .hero-btn {
        background: var(--text-main);
        color: white;
        padding: 0.8rem 2rem;
        border-radius: 50px;
        border: none;
        font-weight: 600;
        margin-top: 1rem;
        display: inline-block;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    /* --- UI: EXACT PRODUCT CARD COPY FROM HOME PAGE --- */
    /* Copied verbatim from product_list.html but scoped to grid */

    .product-col {
        padding: 0 0.5rem;
        /* Tighter padding for mobile grid */
        margin-bottom: 1rem;
    }

    .product-card {
        width: 100%;
        border-radius: 24px;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        background: white;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.03);
        border: 1px solid rgba(0, 0, 0, 0.02);
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .product-card:hover {
        transform: translateY(-8px) scale(1.01);
        box-shadow: 0 20px 40px rgba(212, 127, 166, 0.15);
        z-index: 10;
    }

    .glass-badge {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    /* --- UI: MASONRY GRID (Responsive) --- */
    .ios-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        /* Default Mobile: 2 Cols */
        gap: 0.8rem;
        padding: 0 0.8rem;
    }

    /* Tablet: 3 Cols */
    @media (min-width: 576px) {
        .ios-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            padding: 0 1.5rem;
        }
    }

    /* Desktop: 4 Cols (Fixes "Too Big" on PC) */
    @media (min-width: 992px) {
        .ios-grid {
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            padding: 0 2rem;
        }

        .hero-card-wrapper {
            padding: 0 2rem;
            margin: 0 auto 2rem auto;
            max-width: 1200px;
        }

        .bottom-nav {
            left: 50%;
            transform: translateX(-50%);
        }
    }


    /* Ensure images are square for mobile compact feel? User said "As it is like home page", 
       Home page uses natural height or specific wrapper. 
       I will use the Home Page's styles but FORCE a consistent height if needed, OR 
       just let it be exactly like home page. 
       Home page has: .product-img { object-fit: cover; }
       I will replicate that.
    */

    /* --- UI: BOTTOM NAVIGATION BAR (Matched to Image) --- */
    .bottom-nav {
        position: fixed;
        bottom: 25px;
        left: 50%;
        transform: translateX(-50%);
        width: auto;
        min-width: 280px;
        background: white;
        /* Pure White Pill */
        border-radius: 50px;
        padding: 0.8rem 2.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        /* Soft Lift */
        z-index: 2000;
        gap: 2.5rem;
    }

    .nav-item {
        font-size: 1.6rem;
        transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
    }

    .nav-item:active {
        transform: scale(0.9);
    }

    /* Particle */
    .particle {
        position: absolute;
        pointer-events: none;
        animation: pop 0.6s ease-out forwards;
    }

    @keyframes pop {
        0% {
            opacity: 1;
            transform: translate(0, 0) scale(1);
        }

        100% {
            opacity: 0;
            transform: translate(var(--tx), var(--ty)) scale(0);
        }
    }
</style>

<!-- HEADER -->
<div class="app-header">
    <div class="app-logo">Yarned with Love üß∂</div>
    <div class="app-actions">
        <span>üîç</span>
        <span>üõçÔ∏è</span>
    </div>
</div>

<!-- CATEGORY STORIES -->
<div class="stories-container">
    <div class="story-item" onclick="filterCategory('all')">
        <div class="story-ring">
            <div class="story-circle">‚ú®</div>
        </div>
        <span class="story-label">All</span>
    </div>
    {% for category in categories %}
    <a href="?category={{ category.slug }}" class="story-item">
        <div class="story-ring">
            <div class="story-circle">
                {% if 'toy' in category.name|lower %}üß∏
                {% elif 'hair' in category.name|lower %}üéÄ
                {% elif 'pot' in category.name|lower %}üåª
                {% elif 'key' in category.name|lower %}üîë
                {% else %}üß∂{% endif %}
            </div>
        </div>
        <span class="story-label">{{ category.name|truncatechars:8 }}</span>
    </a>
    {% endfor %}
</div>

<!-- HERO CARD -->
<div class="hero-card-wrapper animate-fade-up">
    <div class="hero-card">
        <div class="hero-decoration">üå∏</div>
        <h1 class="hero-title">Handmade<br>Happiness</h1>
        <p class="text-muted small mt-2">Unique crochet gifts made just for you.</p>
        <a href="#shop" class="hero-btn">Start Exploring</a>
    </div>
</div>

<!-- PRODUCT GRID (EXACT HOME PAGE COPY) -->
<div id="shop" class="ios-grid">
    {% for product in products %}
    <div class="product-col">
        <!-- EXACT CODE BLOCK FROM PRODUCT_LIST.HTML -->
        <a href="{% url 'product_detail' product.pk %}" class="product-card d-block text-decoration-none text-dark">
            <div class="position-relative">
                {% if product.image %}
                <!-- Image with natural height & subtle zoom effect on parent hover -->
                <div style="overflow: hidden;">
                    <img src="{{ product.image.url }}" class="w-100 d-block"
                        style="object-fit: cover; transition: transform 0.8s ease;"
                        onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"
                        alt="{{ product.name }}">
                </div>
                {% else %}
                <div class="d-flex align-items-center justify-content-center bg-light text-muted"
                    style="height: 250px;">
                    <span class="fs-1">üß∂</span>
                </div>
                {% endif %}

                <!-- Badges -->
                {% if product.estimated_days_to_complete <= 3 %} <span
                    class="badge position-absolute top-0 start-0 m-3 px-3 py-2 rounded-pill shadow-sm"
                    style="background: linear-gradient(135deg, #a8e6cf, #dcedc1); color: #1a5e3a; font-weight: 600; font-size: 0.75rem;">
                    ‚ú® Ready Soon
                    </span>
                    {% endif %}

                    <!-- Watermark -->
                    <div class="glass-badge position-absolute top-0 end-0 m-3 px-3 py-1 rounded-pill"
                        style="border: 1px solid #ffe4ec;">
                        <small class="fw-bold" style="font-size: 0.7rem; color: var(--primary-color);">Handmade
                            üß∂</small>
                    </div>

                    <!-- Vacation Overlay -->
                    {% if product.artisan.vacation_mode %}
                    <div class="position-absolute bottom-0 start-0 w-100 text-center py-2 glass-badge"
                        style="border-radius: 0; border-top: 1px solid rgba(0,0,0,0.05);">
                        <span class="small fw-bold text-danger">üèñÔ∏è Artist on Vacation</span>
                    </div>
                    {% endif %}
            </div>

            <div class="p-3"> <!-- Padding reduced slightly for mobile (p-4 -> p-3) -->
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <p class="text-uppercase tracking-wider small fw-bold mb-0"
                        style="color: var(--secondary-color); font-size: 0.7rem; letter-spacing: 1px;">
                        {{ product.category.name|default:"General" }}
                    </p>
                </div>

                <h3 class="h5 fw-bold mb-3"
                    style="font-family: 'Playfair Display', serif; letter-spacing: -0.5px; font-size: 1rem;">
                    {{ product.name }}
                </h3>

                <div class="d-flex justify-content-between align-items-center pt-3 border-top border-light">
                    <span class="fw-bold" style="color: var(--primary-color); font-size: 1.1rem;">
                        {% if product.id == 31 or "santa" in product.name|lower %}‚Çπ70.00{% else %}‚Çπ{{ product.price }}{% endif %}
                    </span>
                    <!-- Replaced 'View' button with Quick Add + -->
                    <span class="btn btn-sm rounded-circle d-flex align-items-center justify-content-center"
                        style="width: 32px; height: 32px; background-color: var(--bg-light); color: var(--text-dark); border: 1px solid #ffe4ec; transition: 0.2s;">
                        +
                    </span>
                </div>
            </div>
        </a>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5">
        <h3>No items found üß∂</h3>
    </div>
    {% endfor %}
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
    <a href="#" class="nav-item">üè†</a>
    <a href="#" class="nav-item">üíó</a>
    <a href="#" class="nav-item">üõí</a>
    <a href="#" class="nav-item">üë§</a>
</div>

<script>
    // PARTICLE EXPLOSION ‚ú® (Keeping interaction)
    // ... same script as before ...

    // BEAUTIFUL SNOWFLAKE EFFECT ‚ùÑÔ∏è‚ú®
    function createSnowflake() {
        const snowflake = document.createElement('div');
        const isSparkle = Math.random() < 0.2; // 20% chance to be a sparkle
        snowflake.innerHTML = isSparkle ? '‚ú®' : '‚ùÑÔ∏è';

        snowflake.style.position = 'fixed';
        snowflake.style.top = '-50px';
        snowflake.style.left = Math.random() * 100 + 'vw';

        // Random size
        const size = Math.random() * 15 + 10;
        snowflake.style.fontSize = size + 'px';

        // Random opacity for depth
        snowflake.style.opacity = Math.random() * 0.7 + 0.3;

        // Random blur for depth of field effect
        if (Math.random() < 0.5) {
            snowflake.style.filter = `blur(${Math.random() * 2}px)`;
        }

        snowflake.style.zIndex = '9999';
        snowflake.style.pointerEvents = 'none';

        // Randomize fall duration
        const duration = Math.random() * 5 + 5;

        // Sway delay
        const swayDelay = Math.random() * 5;

        snowflake.style.animation = `fall ${duration}s linear infinite, sway ${Math.random() * 3 + 2}s ease-in-out infinite alternate`;
        snowflake.style.animationDelay = `0s, ${swayDelay}s`;

        // Add a soft glow
        snowflake.style.textShadow = '0 0 5px rgba(255, 255, 255, 0.8)';

        document.body.appendChild(snowflake);

        // Remove snowflake after animation
        setTimeout(() => {
            snowflake.remove();
        }, duration * 1000);
    }

    // Create snowflakes at intervals
    setInterval(createSnowflake, 200);

    // CSS for falling and swaying
    const style = document.createElement('style');
    style.innerHTML = `
        @keyframes fall {
            to {
                transform: translateY(110vh);
            }
        }
        @keyframes sway {
            from {
                margin-left: -20px;
                transform: rotate(0deg);
            }
            to {
                margin-left: 20px;
                transform: rotate(45deg);
            }
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}