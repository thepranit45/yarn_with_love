{% extends 'base.html' %}
{% load static %}
{% block title %}Shop - Yarned with Love{% endblock %}

{% block content %}
<div class="alert alert-info text-center">{% if 1 %}DJANGO IS RENDERING{% endif %}</div>
<!-- INFINITE MARQUEE (Fixed & Seamless) -->
<div class="marquee-container">
    <div class="marquee-content">
        <span>‚ú® Free Shipping on Orders Over ‚Çπ999! üöö</span>
        <span>üéÄ Custom Orders Open for Wedding Season! üë∞</span>
        <span>üß∂ New Wool Blend Colors Available! üåà</span>
        <span>üíù Use Code WELCOME10 for 10% Off! üéÅ</span>
        <span>‚ú® Free Shipping on Orders Over ‚Çπ999! üöö</span>
        <span>üéÄ Custom Orders Open for Wedding Season! üë∞</span>
        <span>üß∂ New Wool Blend Colors Available! üåà</span>
        <span>üíù Use Code WELCOME10 for 10% Off! üéÅ</span>
    </div>
</div>

<!-- HERO SECTION (Premium Split Layout) -->
<section class="position-relative overflow-hidden py-5"
    style="background: radial-gradient(circle at 10% 20%, rgb(255, 246, 249) 0%, rgb(255, 255, 255) 90%);">
    <!-- Animated Background Blobs -->
    <div class="position-absolute top-0 start-0 translate-middle rounded-circle filter-blur"
        style="width: 300px; height: 300px; background: rgba(255, 200, 221, 0.4); filter: blur(80px); animation: float 6s ease-in-out infinite;">
    </div>
    <div class="position-absolute bottom-0 end-0 translate-middle rounded-circle filter-blur"
        style="width: 400px; height: 400px; background: rgba(200, 230, 255, 0.3); filter: blur(80px); animation: float 8s ease-in-out infinite reverse;">
    </div>

    <div class="container position-relative z-2">
        <div class="row align-items-center min-vh-50">
            <!-- Left Content -->
            <div class="col-lg-6 mb-5 mb-lg-0 text-center text-lg-start animate-fade-up">
                {% if user.is_authenticated %}
                <span class="d-inline-block px-3 py-1 mb-3 rounded-pill"
                    style="background: rgba(255, 105, 180, 0.1); color: var(--primary-color); font-weight: 600; font-size: 0.9rem;">
                    üëã Welcome back, {{ user.get_display_name }}
                </span>
                {% else %}
                <span class="d-inline-block px-3 py-1 mb-3 rounded-pill"
                    style="background: rgba(255, 105, 180, 0.1); color: var(--primary-color); font-weight: 600; font-size: 0.9rem;">
                    üéÄ Handcrafted with Love
                </span>
                {% endif %}

                <h1 class="display-4 fw-bold mb-3"
                    style="font-family: 'Playfair Display', serif; color: var(--text-dark); line-height: 1.2;">
                    Weave Your Dreams <br>
                    <span style="color: var(--primary-color); position: relative; display: inline-block;">
                        Into Reality
                        <svg class="position-absolute w-100"
                            style="bottom: 5px; left: 0; height: 8px; fill: none; stroke: rgba(255, 105, 180, 0.3); stroke-width: 4;"
                            viewBox="0 0 100 10" preserveAspectRatio="none">
                            <path d="M0 5 Q 50 10 100 5" />
                        </svg>
                    </span>
                </h1>

                <p class="lead text-muted mb-4" style="font-size: 1.15rem;">
                    Discover our exclusive collection of bespoke crochet creations. Each stitch tells a story of love,
                    patience, and artistry.
                </p>

                <div class="d-flex justify-content-center justify-content-lg-start gap-3">
                    <a href="#collection" class="btn btn-lg rounded-pill px-4 shadow-sm"
                        style="background: var(--primary-color); color: white; border: none; transition: transform 0.2s;">
                        ‚ú® Shop Collection
                    </a>
                    <a href="#categories" class="btn btn-lg rounded-pill px-4"
                        style="background: white; color: var(--text-dark); border: 1px solid rgba(0,0,0,0.1); transition: transform 0.2s;">
                        Browse Categories
                    </a>
                </div>
            </div>

            <!-- Right Visual (Dynamic Hero Card) -->
            <div class="col-lg-5 offset-lg-1 position-relative">
                <div class="position-relative p-3 bg-white rounded-5 shadow-lg rotate-hover"
                    style="transform: rotate(2deg); transition: transform 0.5s ease;">
                    {% with hero_product=products|random %}
                    {% if hero_product.image %}
                    <div class="rounded-4 overflow-hidden position-relative" style="height: 400px;">
                        <img src="{{ hero_product.image.url }}" class="w-100 h-100" style="object-fit: cover;"
                            alt="Featured Product">
                        <div class="position-absolute bottom-0 start-0 m-3 glass-badge px-3 py-2 rounded-3">
                            <small class="d-block text-muted" style="font-size: 0.75rem;">Featured Creation</small>
                            <span class="fw-bold" style="color: var(--text-dark);">{{ hero_product.name }}</span>
                        </div>
                    </div>
                    {% else %}
                    <!-- Fallback Visual if no products/images -->
                    <div class="rounded-4 d-flex align-items-center justify-content-center"
                        style="height: 400px; background: linear-gradient(45deg, #ffe4ec, #fff0f5);">
                        <div class="text-center">
                            <span style="font-size: 5rem;">üß∂</span>
                            <h3 class="mt-3 h5" style="color: var(--primary-color);">Making Magic...</h3>
                        </div>
                    </div>
                    {% endif %}
                    {% endwith %}

                    <!-- Floating Elements -->
                    <div
                        class="position-absolute top-0 start-0 translate-middle bg-white shadow-sm p-2 rounded-circle animate-float-slow">
                        <span style="font-size: 1.5rem;">üåø</span>
                    </div>
                    <div
                        class="position-absolute bottom-0 end-0 translate-middle bg-white shadow-sm p-3 rounded-4 animate-float-delay">
                        <span class="fw-bold" style="color: var(--primary-color);">100%<br>Handmade</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .animate-float-slow {
            animation: float 4s ease-in-out infinite;
        }

        .animate-float-delay {
            animation: float 5s ease-in-out infinite 1s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(-50%, -50%) translateY(0);
            }

            50% {
                transform: translate(-50%, -50%) translateY(-10px);
            }
        }

        .rotate-hover:hover {
            transform: rotate(0deg) !important;
            scale: 1.02;
        }
    </style>
</section>

<!-- FEATURES SECTION (Premium SVG Icons) -->
<section class="py-5">
    <div class="container">
        <div class="row g-4 text-center">
            <div class="col-md-4">
                <div class="feature-card h-100 p-4 rounded-4 glass-panel shadow-sm border-0 transition-hover">
                    <div class="mb-3 d-inline-flex p-3 rounded-circle"
                        style="background: rgba(168, 230, 207, 0.2); color: #1a5e3a;">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22v-14l-4-4" />
                            <path d="M20.2 13.8l-8.2 8.2" />
                            <path
                                d="M2.5 13.5c1.1-7.1 8.8-9.9 14.5-5.5 1.5 1.2 2.5 2.9 2.5 2.9s2.4-1.6 4.3 0c1.3 1.1 1.6 3 1.2 4.6" />
                        </svg>
                    </div>
                    <h3 class="h5 fw-bold" style="color: var(--primary-color);">Eco-Friendly Yarns</h3>
                    <p class="text-muted small mb-0">Sustainable, skin-friendly materials safe for all.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card h-100 p-4 rounded-4 glass-panel shadow-sm border-0 transition-hover">
                    <div class="mb-3 d-inline-flex p-3 rounded-circle"
                        style="background: rgba(255, 183, 178, 0.2); color: #bd4848;">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z" />
                        </svg>
                    </div>
                    <h3 class="h5 fw-bold" style="color: var(--primary-color);">100% Handmade</h3>
                    <p class="text-muted small mb-0">Crafted with patience, love, and attention to detail.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card h-100 p-4 rounded-4 glass-panel shadow-sm border-0 transition-hover">
                    <div class="mb-3 d-inline-flex p-3 rounded-circle"
                        style="background: rgba(255, 218, 193, 0.3); color: #e67e22;">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                        </svg>
                    </div>
                    <h3 class="h5 fw-bold" style="color: var(--primary-color);">Custom Designs</h3>
                    <p class="text-muted small mb-0">Personalize colors and sizes for the perfect gift.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CATEGORIES SECTION (Premium Polish) -->
<section id="categories" class="py-5 bg-white">
    <div class="container">
        <div class="text-center mb-4">
            <h2 class="display-6 fw-bold" style="color: var(--text-dark); font-family: 'Playfair Display', serif;">
                Browse by Category</h2>
            <p class="text-muted">Find exactly what you're looking for!</p>
        </div>

        <div class="d-flex flex-wrap justify-content-center gap-3">
            <a href="?#collection"
                class="btn btn-lg rounded-pill px-4 py-2 shadow-sm {% if not request.GET.category %}active-category{% endif %}"
                style="background-color: var(--primary-color); color: white; border: none; transition: all 0.3s ease;">
                All ‚ú®
            </a>

            {% if categories %}
            {% for category in categories %}
            <a href="?category={{ category.slug }}#collection"
                class="btn btn-lg rounded-pill px-4 py-2 shadow-sm d-flex align-items-center gap-2 category-pill"
                style="background: rgba(255, 240, 245, 0.6); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); color: var(--text-dark); border: 1px solid rgba(255, 255, 255, 0.5); transition: all 0.3s ease;">
                <span style="font-size: 1.2rem;">
                    {% if 'toy' in category.name|lower %}üß∏
                    {% elif 'hair' in category.name|lower %}üéÄ
                    {% elif 'pot' in category.name|lower %}üåª
                    {% elif 'key' in category.name|lower %}üîë
                    {% elif 'cloth' in category.name|lower or 'wear' in category.name|lower %}üëó
                    {% elif 'bag' in category.name|lower %}üëú
                    {% elif 'home' in category.name|lower or 'decor' in category.name|lower %}üè†
                    {% elif 'flower' in category.name|lower %}üåπ
                    {% else %}üß∂{% endif %}
                </span>
                <span style="font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 600;">{{ category.name }}</span>
            </a>
            {% endfor %}
            {% endif %}
        </div>

        <style>
            .category-pill:hover {
                transform: translateY(-3px);
                background-color: white !important;
                box-shadow: 0 10px 20px rgba(212, 127, 166, 0.2) !important;
                border-color: var(--primary-color) !important;
                color: var(--primary-color) !important;
            }

            .active-category {
                background: var(--primary-color) !important;
                color: white !important;
                box-shadow: 0 10px 20px rgba(212, 127, 166, 0.3) !important;
            }
        </style>
    </div>
</section>

<!-- MEET THE MAKER (Unique Overlapping Design) -->
<section class="py-5 position-relative" style="overflow: hidden;">
    <!-- Decorative Background Elements -->
    <div class="position-absolute top-0 end-0 text-muted opacity-10"
        style="font-size: 15rem; transform: translate(30%, -30%) rotate(20deg); pointer-events: none;">üß∂</div>

    <div class="container py-4">
        <div class="row align-items-center">
            <!-- Image Column (Tilted & Shadowed) -->
            <div class="col-lg-6 position-relative mb-5 mb-lg-0">
                <div class="position-relative" style="z-index: 1;">
                    <div class="rounded-4 overflow-hidden shadow-lg rotate-image"
                        style="transform: rotate(-3deg); transition: transform 0.5s ease; border: 8px solid white;">
                        <!-- Using a product image as a 'Work in Progress' shot since we don't have a specific profile pic yet -->
                        {% with maker_shot=products|random %}
                        {% if maker_shot.image %}
                        <img src="{{ maker_shot.image.url }}" class="w-100"
                            style="height: 500px; object-fit: cover; filter: sepia(20%);" alt="The Maker">
                        {% else %}
                        <div class="bg-light d-flex align-items-center justify-content-center" style="height: 500px;">
                            <span style="font-size: 5rem;">üë©‚Äçüé®</span>
                        </div>
                        {% endif %}
                        {% endwith %}
                    </div>
                </div>
                <!-- Backing decorations -->
                <div class="position-absolute top-0 start-0 w-100 h-100 bg-primary opacity-10 rounded-4"
                    style="transform: rotate(-6deg) scale(0.95); z-index: 0;"></div>
            </div>

            <!-- Content Column (Overlapping Glass Card) -->
            <div class="col-lg-7 ms-auto mt-n5 mt-lg-0" style="margin-left: -10% !important; z-index: 2;">
                <div class="p-5 rounded-4 shadow-lg glass-card animate-fade-left"
                    style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.5);">
                    <span class="text-uppercase fw-bold small"
                        style="color: var(--primary-color); letter-spacing: 2px;">The Hands Behind the Hooks</span>
                    <h2 class="display-5 fw-bold mb-4" style="font-family: 'Playfair Display', serif;">Crafting Warmth,
                        <br>One Stitch at a Time.
                    </h2>
                    <p class="text-muted lead mb-4" style="line-height: 1.8;">
                        "Welcome to my creative corner! Every piece here is born from a quiet moment, a cup of tea, and
                        a love for creating things that last. I believe in slow fashion, meaningful gifts, and the magic
                        of handmade."
                    </p>
                    <div class="d-flex align-items-center gap-4">
                        <div class="d-flex align-items-center gap-2">
                            <div class="rounded-circle bg-light p-2 d-flex">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-danger">
                                    <path
                                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                                    </path>
                                </svg>
                            </div>
                            <span class="fw-bold small">Made with Love</span>
                        </div>
                        <div class="vr"></div>
                        <div>
                            <span class="d-block fw-bold"
                                style="font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--text-dark);">Mansi</span>
                            <span class="small text-muted">Founder & Creator</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .rotate-image:hover {
            transform: rotate(0deg) !important;
        }

        @media (max-width: 991px) {
            .col-lg-7 {
                margin-left: 0 !important;
                margin-top: -30px !important;
            }
        }
    </style>
</section>

<!-- RECOMMENDED SECTION -->
{% if recommended_products %}
<section class="py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-6 fw-bold" style="color: var(--primary-color);">Recommended For You üíñ</h2>
            <p class="text-muted">Because you have great taste!</p>
            <div class="section-divider"></div>
        </div>
        <div class="row g-4">
            {% for product in recommended_products %}
            <div class="col-6 col-md-3">
                <a href="{% url 'product_detail' product.pk %}"
                    class="product-card d-block text-decoration-none text-dark h-100 glass-panel">
                    <div class="position-relative">
                        {% if product.image %}
                        <div style="overflow: hidden;">
                            <img src="{{ product.image.url }}" class="w-100 d-block"
                                style="object-fit: cover; height: 300px; transition: transform 0.8s ease;"
                                onmouseover="this.style.transform='scale(1.05)'"
                                onmouseout="this.style.transform='scale(1)'" alt="{{ product.name }}">
                        </div>
                        {% else %}
                        <div class="d-flex align-items-center justify-content-center bg-light text-muted"
                            style="height: 300px;">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                <circle cx="8.5" cy="8.5" r="1.5" />
                                <polyline points="21 15 16 10 5 21" />
                            </svg>
                        </div>
                        {% endif %}

                        <!-- Badges -->
                        {% if product.estimated_days_to_complete <= 3 %} <span
                            class="badge position-absolute top-0 start-0 m-3 px-3 py-2 rounded-pill shadow-sm d-flex align-items-center gap-1"
                            style="background: linear-gradient(135deg, #a8e6cf, #dcedc1); color: #1a5e3a; font-weight: 600; font-size: 0.75rem;">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
                            </svg>
                            Ready Soon
                            </span>
                            {% endif %}

                            <!-- Watermark -->
                            <div class="glass-badge position-absolute top-0 end-0 m-3 px-3 py-1 rounded-pill d-flex align-items-center gap-1"
                                style="border: 1px solid #ffe4ec;">
                                <small class="fw-bold"
                                    style="font-size: 0.7rem; color: var(--primary-color);">Handmade</small>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="var(--primary-color)"
                                    stroke="none">
                                    <path
                                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                                </svg>
                            </div>
                    </div>

                    <div class="p-4">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <p class="text-uppercase tracking-wider small fw-bold mb-0"
                                style="color: var(--secondary-color); font-size: 0.7rem; letter-spacing: 1px;">
                                {{ product.category.name|default:"General" }}
                            </p>
                            <small class="text-muted" style="font-size: 0.75rem;">
                                By {{ product.artisan.first_name|default:product.artisan.username }}
                            </small>
                        </div>

                        <h3 class="h5 fw-bold mb-3"
                            style="font-family: 'Playfair Display', serif; letter-spacing: -0.5px;">
                            {{ product.name }}
                        </h3>

                        <div class="d-flex justify-content-between align-items-center pt-3 border-top border-light">
                            <span class="fw-bold" style="color: var(--primary-color); font-size: 1.2rem;">
                                <span>‚Çπ</span>{{ product.price }}
                            </span>
                            <span class="btn btn-sm rounded-pill px-3"
                                style="background-color: var(--bg-light); color: var(--text-dark); border: 1px solid #ffe4ec; transition: 0.2s;">
                                View ‚ûú
                            </span>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- COLLECTION SECTION -->
<section id="collection" class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            {% if query %}
            <h2 class="display-5 fw-bold" style="color: var(--text-dark);">Search Results for "{{ query }}"</h2>
            <a href="{% url 'product_list' %}" class="btn btn-sm btn-outline-dark mt-2">Clear Search</a>
            {% else %}
            <h2 class="display-5 fw-bold" style="color: var(--text-dark);">Our Lovely Collection</h2>
            <p class="text-muted">Handpicked treasures just for you ‚ú®</p>
            {% endif %}
            <div class="section-divider"></div>
        </div>

        <!-- Masonry Grid Layout (Premium Polish) -->
        <style>
            .product-col {
                display: flex;
            }

            .product-card {
                width: 100%;
                border-radius: 24px;
                overflow: hidden;
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                background: white;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.03);
                border: 1px solid rgba(0, 0, 0, 0.02);
                position: relative;
                display: flex;
                flex-direction: column;
            }

            .product-card:hover {
                transform: translateY(-8px) scale(1.01);
                box-shadow: 0 20px 40px rgba(212, 127, 166, 0.15);
                z-index: 10;
            }

            .glass-badge {
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                border: 1px solid rgba(255, 255, 255, 0.5);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            }
        </style>

        <div class="row g-4">
            {% for product in products %}
            <!-- DEBUG BLOCK REMOVED -->
            <div class="col-12 col-sm-6 col-md-4 col-xl-3 product-col">
                <a href="{% url 'product_detail' product.pk %}"
                    class="product-card d-block text-decoration-none text-dark glass-panel">
                    <div class="position-relative">
                        {% if product.image %}
                        <!-- Image with natural height & subtle zoom effect on parent hover -->
                        <div style="overflow: hidden;">
                            <img src="{{ product.image.url }}" class="w-100 d-block"
                                style="object-fit: cover; transition: transform 0.8s ease;"
                                onmouseover="this.style.transform='scale(1.05)'"
                                onmouseout="this.style.transform='scale(1)'" alt="{{ product.name }}">
                        </div>
                        {% else %}
                        <div class="d-flex align-items-center justify-content-center bg-light text-muted"
                            style="height: 250px;">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                <circle cx="8.5" cy="8.5" r="1.5" />
                                <polyline points="21 15 16 10 5 21" />
                            </svg>
                        </div>
                        {% endif %}

                        <!-- Badges -->
                        {% if product.estimated_days_to_complete <= 3 %} <span
                            class="badge position-absolute top-0 start-0 m-3 px-3 py-2 rounded-pill shadow-sm d-flex align-items-center gap-1"
                            style="background: linear-gradient(135deg, #a8e6cf, #dcedc1); color: #1a5e3a; font-weight: 600; font-size: 0.75rem;">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
                            </svg>
                            Ready Soon
                            </span>
                            {% endif %}

                            <!-- Watermark -->
                            <div class="glass-badge position-absolute top-0 end-0 m-3 px-3 py-1 rounded-pill d-flex align-items-center gap-1"
                                style="border: 1px solid #ffe4ec;">
                                <small class="fw-bold"
                                    style="font-size: 0.7rem; color: var(--primary-color);">Handmade</small>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="var(--primary-color)"
                                    stroke="none">
                                    <path
                                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                                </svg>
                            </div>

                            <!-- Vacation Overlay -->
                            {% if product.artisan.vacation_mode %}
                            <div class="position-absolute bottom-0 start-0 w-100 text-center py-2 glass-badge d-flex align-items-center justify-content-center gap-2"
                                style="border-radius: 0; border-top: 1px solid rgba(0,0,0,0.05);">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#dc3545"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 2.69l5.74 9.94H6.26L12 2.69zM12 18h.01M1 22h22" />
                                </svg>
                                <span class="small fw-bold text-danger">Artist on Break</span>
                            </div>
                            {% endif %}
                    </div>

                    <div class="p-4">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <p class="text-uppercase tracking-wider small fw-bold mb-0"
                                style="color: var(--secondary-color); font-size: 0.7rem; letter-spacing: 1px;">
                                {{ product.category.name|default:"General" }}
                            </p>
                            <small class="text-muted" style="font-size: 0.75rem;">
                                By {{ product.artisan.first_name|default:product.artisan.username }}
                            </small>
                        </div>

                        <h3 class="h5 fw-bold mb-3"
                            style="font-family: 'Playfair Display', serif; letter-spacing: -0.5px;">
                            {{ product.name }}
                        </h3>

                        <div class="d-flex justify-content-between align-items-center pt-3 border-top border-light">
                            <span class="fw-bold" style="color: var(--primary-color); font-size: 1.2rem;">
                                <span>‚Çπ</span>{{ product.price }}
                            </span>
                            <span class="btn btn-sm rounded-pill px-3"
                                style="background-color: var(--bg-light); color: var(--text-dark); border: 1px solid #ffe4ec; transition: 0.2s;">
                                View ‚ûú
                            </span>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <div style="font-size: 4rem; opacity: 0.5;">üß∂</div>
                <h3>No products found.</h3>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- TESTIMONIALS & INSTAGRAM (Trending Features) -->
<section class="py-5 bg-white">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Love Letters üíå</h2>
        </div>
        <div class="testimonial-scroller">
            {% for review in featured_reviews %}
            <div class="testimonial-card">
                <div class="mb-2">
                    {% for i in "12345"|make_list %}
                    {% if forloop.counter <= review.rating %}‚≠ê{% endif %} {% endfor %} </div>
                        <p class="mb-2 fst-italic">"{{ review.comment|truncatechars:80 }}"</p>
                        <small class="fw-bold">-
                            {% if review.customer_name %}
                            {{ review.customer_name }}
                            {% elif review.customer.get_display_name %}
                            {{ review.customer.get_display_name }}
                            {% else %}
                            Valued Customer
                            {% endif %}
                        </small>
                </div>
                {% empty %}
                <div class="testimonial-card">
                    <div class="mb-2">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="mb-2 fst-italic">"The most beautiful sweater I own!"</p>
                    <small class="fw-bold">- Priya S.</small>
                </div>
                <div class="testimonial-card">
                    <div class="mb-2">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="mb-2 fst-italic">"Packaging was so cute! üéÄ"</p>
                    <small class="fw-bold">- Anjali M.</small>
                </div>
                {% endfor %}
            </div>
        </div>
</section>

<section class="py-4">
    <div class="container-fluid p-0">
        <div class="text-center mb-4">
            <h5 class="fw-bold">
                <a href="https://www.instagram.com/_yarned.with.love_/" target="_blank"
                    class="text-decoration-none text-dark">
                    @yarned_with_love üì∏
                </a>
            </h5>
        </div>
        <div class="insta-grid">
            <div class="insta-item" style="background-color: #ffe4ec;">üß∂</div>
            <div class="insta-item" style="background-color: #fff0f5;">üßµ</div>
            <div class="insta-item" style="background-color: #e6e6fa;">üß£</div>
            <div class="insta-item" style="background-color: #ffe4e1;">üß§</div>
            <div class="insta-item" style="background-color: #f0fff0;">üß∏</div>
            <div class="insta-item" style="background-color: #fff5ee;">üéÄ</div>
        </div>
    </div>
</section>

<!-- NEWSLETTER (Unique Torn Paper Design) -->
<section class="py-5 position-relative mt-5">
    <!-- Torn Edge Top -->
    <div class="position-absolute top-0 start-0 w-100"
        style="height: 20px; background-color: white; mask-image: url('data:image/svg+xml;utf8,<svg viewBox=%220 0 1200 20%22 xmlns=%22http://www.w3.org/2000/svg%22><path d=%22M0 20L50 0L100 20L150 0L200 20L250 0L300 20L350 0L400 20L450 0L500 20L550 0L600 20L650 0L700 20L750 0L800 20L850 0L900 20L950 0L1000 20L1050 0L1100 20L1150 0L1200 20V0H0V20Z%22 fill=%22black%22/></svg>'); mask-size: 30px 100%; z-index: 2;">
    </div>

    <div class="py-5"
        style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border-radius: 0;">
        <div class="container text-center position-relative z-1">
            <span class="d-inline-block p-3 rounded-circle bg-white mb-3 shadow-lg"
                style="color: var(--primary-color);">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
            </span>
            <h2 class="fw-bold mb-2">Join Our Knitting Circle üíå</h2>
            <p class="mb-4 opacity-75">Get VIP access, free patterns, and secret sales!</p>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <form action="{% url 'subscribe' %}" method="POST">
                        {% csrf_token %}
                        <div class="input-group p-1 bg-white rounded-pill shadow-lg">
                            <input type="email" name="email" class="form-control border-0 rounded-pill py-3 px-4"
                                placeholder="Your email address..." required style="box-shadow: none;">
                            <button type="submit" class="btn btn-dark rounded-pill px-4 m-1 fw-bold">Sign Me
                                Up!</button>
                        </div>
                    </form>
                    <p class="small mt-3 opacity-50">No spam, just yarn. üß∂</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Floating Background Decorations (Parallax/Float) -->
<div class="background-decorations position-fixed top-0 start-0 w-100 h-100 pe-none" style="z-index: -1;">
    <div class="decoration-item position-absolute"
        style="top: 15%; left: 5%; opacity: 0.05; animation: float-slow 8s infinite ease-in-out;">
        <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor" class="text-primary">
            <circle cx="12" cy="12" r="10" />
        </svg>
    </div>
    <div class="decoration-item position-absolute"
        style="top: 45%; right: 8%; opacity: 0.08; animation: float-slow 12s infinite ease-in-out reverse;">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"
            class="text-danger">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
        </svg>
    </div>
    <div class="decoration-item position-absolute"
        style="bottom: 20%; left: 10%; opacity: 0.06; animation: float-slow 10s infinite ease-in-out 1s;">
        <span style="font-size: 4rem;">üß∂</span>
    </div>
</div>

<a href="#" class="floating-chat-btn">üí¨</a>

<style>
    /* Global Animations */
    @keyframes float-slow {

        0%,
        100% {
            transform: translateY(0) rotate(0deg);
        }

        50% {
            transform: translateY(-20px) rotate(5deg);
        }
    }

    .animate-on-scroll {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .animate-on-scroll.is-visible {
        opacity: 1;
        transform: translateY(0);
    }

    .animate-fade-left {
        opacity: 0;
        transform: translateX(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .animate-fade-left.is-visible {
        opacity: 1;
        transform: translateX(0);
    }

    /* Premium Text Gradient */
    .text-gradient-premium {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* Staggered Animation for Category Pills */
    .category-pill {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.5s ease forwards;
    }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .category-pill:nth-child(1) {
        animation-delay: 0.1s;
    }

    .category-pill:nth-child(2) {
        animation-delay: 0.2s;
    }

    .category-pill:nth-child(3) {
        animation-delay: 0.3s;
    }

    .category-pill:nth-child(4) {
        animation-delay: 0.4s;
    }

    .category-pill:nth-child(5) {
        animation-delay: 0.5s;
    }

    .category-pill:nth-child(6) {
        animation-delay: 0.6s;
    }

    .category-pill:nth-child(7) {
        animation-delay: 0.7s;
    }

    /* 3D Tilt Effect Classes */
    .js-tilt {
        transform-style: preserve-3d;
        transform: perspective(1000px);
    }

    /* Phase 8: Knitting Theme (Cozy & Stitched) */
    .glass-panel {
        background: #fffbfb !important;
        /* Warm White */
        border: 2px dashed #ffb7b2 !important;
        /* Stitch effect */
        box-shadow: 6px 6px 0px rgba(255, 183, 178, 0.4) !important;
        /* Hard offset shadow */
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border-radius: 20px !important;
    }

    .glass-panel:hover {
        transform: translateY(-5px);
        box-shadow: 8px 8px 0px rgba(255, 183, 178, 0.6) !important;
        border-color: var(--primary-color) !important;
    }

    /* Knitted Background Texture */
    body {
        background-color: #fff5f8;
        background-image: radial-gradient(#ffccdb 1px, transparent 1px), radial-gradient(#ffccdb 1px, transparent 1px);
        background-size: 20px 20px;
        background-position: 0 0, 10px 10px;
    }

    /* Enhance floating chat button with glass */
    .floating-chat-btn {
        background: rgba(255, 105, 180, 0.8) !important;
        backdrop-filter: blur(4px);
        border: 1px solid rgba(255, 255, 255, 0.4);
    }

    /* Shimmer Button Effect */
    .btn-shimmer {
        position: relative;
        overflow: hidden;
    }

    .btn-shimmer::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
        0% {
            left: -100%;
        }

        20% {
            left: 100%;
        }

        100% {
            left: 100%;
        }
    }

    /* Cursor Trail Particles */
    .cursor-particle {
        position: fixed;
        width: 8px;
        height: 8px;
        background: var(--primary-color);
        border-radius: 50%;
        pointer-events: none;
        z-index: 9999;
        transition: transform 0.5s ease, opacity 0.5s ease;
    }

    /* Typewriter Effect */
    .typewriter-text {
        overflow: hidden;
        border-right: .15em solid orange;
        white-space: nowrap;
        margin: 0 auto;
        letter-spacing: .15em;
        animation: typing 3.5s steps(40, end), blink-caret .75s step-end infinite;
    }

    @keyframes typing {
        from {
            width: 0
        }

        to {
            width: 100%
        }
    }

    @keyframes blink-caret {

        from,
        to {
            border-color: transparent
        }

        50% {
            border-color: orange;
        }
    }
</style>

<!-- Live Visitor Counter -->
<div id="live-counter"
    class="position-fixed bottom-0 start-0 m-4 px-3 py-2 rounded-pill bg-white shadow-lg d-flex align-items-center gap-2 animate-fade-up"
    style="z-index: 1000; border: 1px solid rgba(0,0,0,0.05);">
    <span class="position-relative d-flex h-3 w-3">
        <span class="animate-ping position-absolute d-inline-flex h-100 w-100 rounded-circle bg-success opacity-75"
            style="width: 10px; height: 10px;"></span>
        <span class="position-relative d-inline-flex rounded-circle bg-success"
            style="width: 10px; height: 10px;"></span>
    </span>
    <span class="small fw-bold text-muted"><span id="visitor-count" class="text-dark">12</span> knitting lovers
        online</span>
</div>
<style>
    .animate-ping {
        animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
    }

    @keyframes ping {

        75%,
        100% {
            transform: scale(2);
            opacity: 0;
        }
    }
</style>

<script>
    // 3D Tilt Logic (Vanilla JS)
    document.addEventListener('DOMContentLoaded', () => {
        const cards = document.querySelectorAll('.product-card, .feature-card, .glass-card, .rotate-image');

        cards.forEach(card => {
            card.classList.add('js-tilt');

            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                const rotateX = ((y - centerY) / centerY) * -5; // Max rotation deg
                const rotateY = ((x - centerX) / centerX) * 5;

                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
            });

            card.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
            });
        });

        // Simple Interaction Observer for Scroll Animations
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target); // Only animate once
                }
            });
        }, observerOptions);

        // Select elements to animate
        const animatedElements = document.querySelectorAll('.animate-fade-up, .animate-fade-left, .feature-card, .product-card, .testimonial-card');

        animatedElements.forEach(el => {
            el.classList.add('animate-on-scroll');
            observer.observe(el);
        });

        // Live Counter Simulation
        const countEl = document.getElementById('visitor-count');
        if (countEl) {
            setInterval(() => {
                let current = parseInt(countEl.innerText);
                let change = Math.random() > 0.5 ? 1 : -1;
                let next = current + change;
                if (next > 5 && next < 50) countEl.innerText = next;
            }, 5000);
        }

        // Add Shimmer, Confetti, and Magnetic Effect to Buttons
        document.querySelectorAll('.btn-main, .btn-dark, .btn-primary').forEach(btn => {
            btn.classList.add('btn-shimmer');

            // Confetti
            btn.addEventListener('click', (e) => {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#D47FA6', '#A8E6CF', '#FFB7B2']
                });
            });

            // Magnetic Effect
            btn.addEventListener('mousemove', function (e) {
                const rect = btn.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;

                btn.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px)`;
                btn.style.transition = 'transform 0.1s ease';
            });

            btn.addEventListener('mouseleave', function () {
                btn.style.transform = 'translate(0, 0)';
                btn.style.transition = 'transform 0.5s ease';
            });
        });

        // Cursor Trail Effect
        document.addEventListener('mousemove', function (e) {
            if (Math.random() < 0.8) return; // Limit particles

            const star = document.createElement('div');
            star.classList.add('cursor-particle');
            star.style.left = e.pageX + 'px';
            star.style.top = e.pageY + 'px';
            star.style.backgroundColor = ['#D47FA6', '#A8E6CF', '#FFB7B2'][Math.floor(Math.random() * 3)];

            document.body.appendChild(star);

            setTimeout(() => {
                star.style.transform = 'translateY(20px) scale(0)';
                star.style.opacity = '0';
            }, 50);

            setTimeout(() => {
                star.remove();
            }, 600);
        });
    });
</script>

<!-- Confetti CDN -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
{% endblock %}