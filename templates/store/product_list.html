{% extends 'base.html' %}
{% load static %}
{% block title %}Shop - Yarned with Love{% endblock %}

{% block content %}
<!-- MOBILE-FIRST "POCKET BOUTIQUE" THEME START üì±üéÄ -->
<meta name="theme-color" content="#fff5f9">

<!-- APP HEADER (Visible only on Mobile) -->
<!-- APP HEADER (Visible only on Mobile) -->
<div class="app-header position-relative z-3">
    <div class="app-logo"
        style="font-family: 'Playfair Display', serif; font-weight: 700; font-size: 1.5rem; color: var(--primary-color); letter-spacing: -0.5px;">
        Yarned with Love üß∂</div>
    <div class="d-flex gap-3 text-secondary fs-4">
        <span onclick="toggleSearch()" role="button">üîç</span>
        <a href="{% url 'about_us' %}" class="text-decoration-none text-secondary">üìñ</a>
        <a href="{% url 'my_orders' %}" class="text-decoration-none text-secondary">üì¶</a>
    </div>
</div>

<!-- HIDDEN MOBILE SEARCH BAR -->
<div id="mobileSearch" class="bg-white border-bottom shadow-sm px-3 py-2"
    style="display: none; position: absolute; top: 60px; left: 0; width: 100%; z-index: 1000;">
    <form action="{% url 'product_list' %}" method="GET" class="d-flex gap-2 mb-0 position-relative">
        <input type="text" name="q" id="searchInput" class="form-control rounded-pill border-0 bg-light"
            placeholder="Search for cozy things... üß∂" value="{{ query }}" autocomplete="off">
        <button type="submit" class="btn btn-primary rounded-circle shadow-sm"
            style="width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">
            ‚ûù
        </button>
        <div id="suggestionsBox" class="position-absolute bg-white shadow-lg rounded-3 w-100"
            style="top: 100%; left: 0; z-index: 1050; display: none; overflow: hidden; margin-top: 5px;">
        </div>
    </form>
</div>

<script>
    function toggleSearch() {
        const searchBar = document.getElementById('mobileSearch');
        if (searchBar.style.display === 'none') {
            searchBar.style.display = 'block';
            const input = document.getElementById('searchInput');
            if (input) input.focus();
        } else {
            searchBar.style.display = 'none';
            document.getElementById('suggestionsBox').style.display = 'none';
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('searchInput');
        const suggestionsBox = document.getElementById('suggestionsBox');

        if (searchInput) {
            searchInput.addEventListener('input', function (e) {
                const query = e.target.value.trim();

                if (query.length < 2) {
                    suggestionsBox.style.display = 'none';
                    return;
                }

                fetch(`/store/api/search-suggestions/?term=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(data => {
                        suggestionsBox.innerHTML = '';
                        if (data.length > 0) {
                            data.forEach(item => {
                                const div = document.createElement('div');
                                div.className = 'p-3 border-bottom d-flex align-items-center gap-2 suggestion-item bg-white';
                                div.style.cursor = 'pointer';
                                div.onmouseover = function () { this.style.backgroundColor = '#f8f9fa'; };
                                div.onmouseout = function () { this.style.backgroundColor = 'white'; };
                                div.innerHTML = `<span>üß∂</span> <span class="fw-bold text-dark">${item.label}</span>`;
                                div.onclick = () => window.location.href = item.url;
                                suggestionsBox.appendChild(div);
                            });
                            suggestionsBox.style.display = 'block';
                        } else {
                            suggestionsBox.style.display = 'none';
                        }
                    })
                    .catch(err => console.error('Error fetching suggestions:', err));
            });

            // Hide suggestions on click outside
            document.addEventListener('click', function (e) {
                if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
                    suggestionsBox.style.display = 'none';
                }
            });
        }
    });
</script>

<!-- INFINITE MARQUEE (Fixed & Seamless) -->
<div class="marquee-container">
    <div class="marquee-content">
        <span>‚ú® Free Shipping on Orders Over ‚Çπ999! üöö</span>
        <span>üéÄ Custom Orders Open for Wedding Season! üë∞</span>
        <span>üß∂ New Wool Blend Colors Available! üåà</span>
        <span>üíù Use Code WELCOME10 for 10% Off! üéÅ</span>
        <span>‚ú® Free Shipping on Orders Over ‚Çπ999! üöö</span>
        <span>üéÄ Custom Orders Open for Wedding Season! üë∞</span>
        <span>üß∂ New Wool Blend Colors Available! üåà</span>
        <span>üíù Use Code WELCOME10 for 10% Off! üéÅ</span>
    </div>
</div>

<!-- HERO SECTION (Playful Theme) -->
<section class="hero-section-new">
    <div class="hero-flower-top">üíê</div>
    <div class="container position-relative z-2">
        <div class="row align-items-center justify-content-center text-center">
            <div class="col-lg-8 animate-fade-up">
                {% if user.is_authenticated %}
                <h3 class="mb-3" style="color: var(--primary-color);">Hello, {{ user.get_display_name }}! üëã</h3>
                {% endif %}
                <span class="hero-badge">üéÄ Handcrafted with Soul üéÄ</span>
                <h1 class="hero-title-new">Weave Your Dreams <br><em>Into Reality.</em></h1>
                <p class="hero-subtitle mx-auto text-muted mb-4" style="max-width: 600px; font-size: 1.1rem;">
                    Discover our exclusive collection of bespoke crochet creations. <br>
                    Each stitch tells a story of love, patience, and artistry. üíù
                </p>
                <div class="d-flex justify-content-center gap-3">
                    <a href="#collection" class="btn btn-main btn-lg">‚ú® Explore Collection</a>
                    <a href="#categories" class="btn btn-outline-dark btn-lg rounded-pill">Browse Categories</a>
                </div>
            </div>
        </div>
    </div>
    <div class="hero-decoration-left">üéÄ</div>
    <div class="hero-decoration-right">üß∂</div>
</section>

<!-- FEATURES SECTION -->
<section class="py-5">
    <div class="container">
        <div class="row g-4 text-center">
            <div class="col-md-4">
                <div class="feature-card">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üåø</div>
                    <h3 class="h5 fw-bold" style="color: var(--primary-color);">Eco-Friendly Materials</h3>
                    <p class="text-muted small">We use only sustainable, skin-friendly yarns for our creations.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üñêÔ∏è</div>
                    <h3 class="h5 fw-bold" style="color: var(--primary-color);">100% Handmade</h3>
                    <p class="text-muted small">Every item is crafted by hand, ensuring uniqueness and quality.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üíù</div>
                    <h3 class="h5 fw-bold" style="color: var(--primary-color);">Customizable</h3>
                    <p class="text-muted small">Personalize your orders to make the perfect gift for loved ones.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- STORY CIRCLES (Mobile Categories) -->
<div class="stories-container">
    <a href="?#collection" class="story-item">
        <div class="story-ring"
            style="{% if not request.GET.category %}border-color: var(--primary-color); transform: scale(1.1);{% endif %}">
            <div class="story-circle">‚ú®</div>
        </div>
        <span class="story-label"
            style="{% if not request.GET.category %}color: var(--primary-color); font-weight: bold;{% endif %}">All</span>
    </a>
    {% if categories %}
    {% for category in categories %}
    <a href="?category={{ category.slug }}#collection" class="story-item">
        <div class="story-ring">
            <div class="story-circle">
                {% if 'toy' in category.name|lower %}üß∏
                {% elif 'hair' in category.name|lower %}üéÄ
                {% elif 'pot' in category.name|lower %}üåª
                {% elif 'key' in category.name|lower %}üîë
                {% elif 'cloth' in category.name|lower or 'wear' in category.name|lower %}üëó
                {% elif 'bag' in category.name|lower %}üëú
                {% elif 'home' in category.name|lower or 'decor' in category.name|lower %}üè†
                {% elif 'flower' in category.name|lower %}üåπ
                {% else %}üß∂{% endif %}
            </div>
        </div>
        <span class="story-label">{{ category.name|truncatechars:8 }}</span>
    </a>
    {% endfor %}
    {% endif %}
</div>

<!-- CATEGORIES SECTION (Premium Polish - Hidden on Mobile) -->
<section id="categories" class="py-5 bg-white">
    <div class="container">
        <div class="text-center mb-4">
            <h2 class="display-6 fw-bold" style="color: var(--text-dark); font-family: 'Playfair Display', serif;">
                Browse by Category</h2>
            <p class="text-muted">Find exactly what you're looking for!</p>
        </div>

        <div class="d-flex flex-wrap justify-content-center gap-3">
            <a href="?#collection"
                class="btn btn-lg rounded-pill px-4 py-2 shadow-sm {% if not request.GET.category %}active-category{% endif %}"
                style="background-color: var(--primary-color); color: white; border: none; transition: all 0.3s ease;">
                All ‚ú®
            </a>

            {% if categories %}
            {% for category in categories %}
            <a href="?category={{ category.slug }}#collection"
                class="btn btn-lg rounded-pill px-4 py-2 shadow-sm d-flex align-items-center gap-2 category-pill"
                style="background-color: #fff0f5; color: var(--text-dark); border: 1px solid rgba(0,0,0,0.05); transition: all 0.3s ease;">
                <span style="font-size: 1.2rem;">
                    {% if 'toy' in category.name|lower %}üß∏
                    {% elif 'hair' in category.name|lower %}üéÄ
                    {% elif 'pot' in category.name|lower %}üåª
                    {% elif 'key' in category.name|lower %}üîë
                    {% elif 'cloth' in category.name|lower or 'wear' in category.name|lower %}üëó
                    {% elif 'bag' in category.name|lower %}üëú
                    {% elif 'home' in category.name|lower or 'decor' in category.name|lower %}üè†
                    {% elif 'flower' in category.name|lower %}üåπ
                    {% else %}üß∂{% endif %}
                </span>
                <span style="font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 600;">{{ category.name }}</span>
            </a>
            {% endfor %}
            {% endif %}
        </div>

        <style>
            .category-pill:hover {
                transform: translateY(-3px);
                background-color: white !important;
                box-shadow: 0 10px 20px rgba(212, 127, 166, 0.2) !important;
                border-color: var(--primary-color) !important;
                color: var(--primary-color) !important;
            }

            .active-category {
                background: var(--primary-color) !important;
                color: white !important;
                box-shadow: 0 10px 20px rgba(212, 127, 166, 0.3) !important;
            }
        </style>
    </div>
</section>



<!-- COLLECTION SECTION -->
<section id="collection" class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            {% if query %}
            <h2 class="display-5 fw-bold" style="color: var(--text-dark);">Search Results for "{{ query }}"</h2>
            <a href="{% url 'product_list' %}" class="btn btn-sm btn-outline-dark mt-2">Clear Search</a>
            {% else %}
            <h2 class="display-5 fw-bold" style="color: var(--text-dark);">Our Lovely Collection</h2>
            <p class="text-muted">Handpicked treasures just for you ‚ú®</p>
            {% endif %}
            <div class="section-divider"></div>
        </div>

        <!-- SPECIAL SEASONAL OFFER DISPLAY -->
        <!-- SPECIAL SEASONAL OFFER DISPLAY -->
        <div class="row justify-content-center mb-5">
            <div class="col-lg-10">
                <a href="{% url 'product_detail' 31 %}" class="text-decoration-none">
                    <div class="card border-0 shadow-lg overflow-hidden position-relative"
                        style="background: #e53935; border-radius: 28px; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);">

                        <!-- Premium Sparkle Overlay -->
                        <div class="sparkle-overlay"></div>

                        <style>
                            .card:hover {
                                transform: translateY(-8px) scale(1.01);
                                box-shadow: 0 20px 40px rgba(183, 28, 28, 0.4) !important;
                            }

                            .sparkle-overlay {
                                position: absolute;
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                background-image: radial-gradient(white 1px, transparent 1px), radial-gradient(white 1px, transparent 1px);
                                background-size: 50px 50px;
                                background-position: 0 0, 25px 25px;
                                opacity: 0.1;
                                animation: sparkleMove 20s linear infinite;
                                pointer-events: none;
                            }

                            @keyframes sparkleMove {
                                0% {
                                    background-position: 0 0, 25px 25px;
                                }

                                100% {
                                    background-position: 50px 50px, 75px 75px;
                                }
                            }

                            .glass-text-container {
                                background: rgba(255, 255, 255, 0.1);
                                backdrop-filter: blur(5px);
                                border-radius: 20px;
                                border: 1px solid rgba(255, 255, 255, 0.2);
                            }

                            .cta-btn-shine {
                                position: relative;
                                overflow: hidden;
                                transition: all 0.3s ease;
                            }

                            .cta-btn-shine::after {
                                content: '';
                                position: absolute;
                                top: 0;
                                left: -100%;
                                width: 100%;
                                height: 100%;
                                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
                                transition: 0.5s;
                            }

                            .cta-btn-shine:hover::after {
                                left: 100%;
                            }

                            .cta-btn-shine:hover {
                                transform: scale(1.05);
                                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2) !important;
                            }

                            /* Mobile Optimizations */
                            @media (max-width: 768px) {
                                .santa-title {
                                    font-size: 2.2rem !important;
                                    margin-bottom: 0.5rem !important;
                                }

                                .santa-lead {
                                    font-size: 0.95rem !important;
                                }

                                .santa-img-container {
                                    min-height: 220px !important;
                                    height: auto !important;
                                }

                                .glass-text-container {
                                    flex-direction: row !important;
                                }

                                /* Keep price next to deal on mobile if space permits */
                                .p-responsive {
                                    padding: 2rem 1rem !important;
                                }

                                .floating-decor {
                                    display: none !important;
                                }

                                /* Hide floating icons to reduce clutter */
                            }

                            @media (min-width: 769px) {
                                .santa-img-container {
                                    height: 100%;
                                    min-height: 320px;
                                }

                                .p-responsive {
                                    padding: 3rem !important;
                                }
                            }
                        </style>

                        <div class="row g-0 align-items-center">
                            <!-- Image Side -->
                            <div class="col-md-5 position-relative">
                                <div class="santa-img-container" style="overflow: hidden;">
                                    <img src="{% static 'images/santa_keychain.jpg' %}" class="w-100 h-100"
                                        style="object-fit: cover; object-position: center; transition: transform 0.5s ease;"
                                        onmouseover="this.style.transform='scale(1.1)'"
                                        onmouseout="this.style.transform='scale(1)'" alt="Christmas Special">
                                </div>
                            </div>

                            <!-- Content Side -->
                            <div
                                class="col-md-7 text-white p-responsive text-center text-md-start position-relative z-1">
                                {% if featured_deal %}
                                <span class="badge mb-3 px-3 py-2 rounded-pill fw-bold shadow-sm"
                                    style="background: linear-gradient(45deg, #FFD700, #ffecb3); color: #b71c1c; letter-spacing: 1px;">
                                    üåü TODAY'S SPECIAL
                                </span>

                                <h1 class="display-4 fw-bold santa-title"
                                    style="font-family: 'Berkshire Swash', cursive; text-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                                    {{ featured_deal.name }}
                                </h1>

                                <p class="lead mb-4 santa-lead"
                                    style="font-size: 1.1rem; opacity: 0.95; line-height: 1.6;">
                                    {{ featured_deal.description|truncatewords:15 }} üß∂‚ú®
                                </p>

                                <div
                                    class="glass-text-container p-3 mb-4 d-inline-flex flex-column flex-md-row align-items-center gap-3">
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="fs-5 text-uppercase tracking-wide"
                                            style="font-size: 0.8rem; opacity: 0.8;">Deal Price</span>
                                        <span class="display-6 fw-bold"
                                            style="color: #FFD700; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">‚Çπ70</span>
                                    </div>
                                    <div class="vr d-none d-md-block bg-white opacity-50"></div>
                                    <div class="d-flex align-items-center gap-2 text-white-50">
                                        <span class="text-decoration-line-through">‚Çπ120</span>
                                        <span class="badge bg-white text-danger fw-bold rounded-1">42% OFF</span>
                                    </div>
                                </div>

                                <div class="d-flex gap-3 justify-content-center justify-content-md-start">
                                    <a href="{% url 'product_detail' featured_deal.pk %}"
                                        class="btn btn-light btn-lg rounded-pill px-5 fw-bold shadow-lg cta-btn-shine"
                                        style="color: #b71c1c; font-family: 'Plus Jakarta Sans', sans-serif;">
                                        Check it out! üéÅ
                                    </a>
                                </div>
                                {% else %}
                                <span class="badge mb-3 px-3 py-2 rounded-pill fw-bold shadow-sm"
                                    style="background: linear-gradient(45deg, #FFD700, #ffecb3); color: #b71c1c; letter-spacing: 1px;">
                                    üéÖ LIMITED EDITION
                                </span>

                                <h1 class="display-3 mb-3 fw-bold santa-title"
                                    style="font-family: 'Berkshire Swash', cursive; text-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                                    Christmas Special
                                </h1>

                                <p class="lead mb-4 santa-lead"
                                    style="font-size: 1.1rem; opacity: 0.95; line-height: 1.6;">
                                    Make this season magical with our exclusive <br>
                                    <strong>Hand-Knit Santa Keychain!</strong> üß∂‚ú®
                                </p>

                                <div
                                    class="glass-text-container p-3 mb-4 d-inline-flex flex-column flex-md-row align-items-center gap-3">
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="fs-5 text-uppercase tracking-wide"
                                            style="font-size: 0.8rem; opacity: 0.8;">Deal Price</span>
                                        <span class="display-6 fw-bold"
                                            style="color: #FFD700; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">‚Çπ70</span>
                                    </div>
                                    <div class="vr d-none d-md-block bg-white opacity-50"></div>
                                    <div class="d-flex align-items-center gap-2 text-white-50">
                                        <span class="text-decoration-line-through">‚Çπ120</span>
                                        <span class="badge bg-white text-danger fw-bold rounded-1">42% OFF</span>
                                    </div>
                                </div>

                                <div class="d-flex gap-3 justify-content-center justify-content-md-start">
                                    <span class="btn btn-light btn-lg rounded-pill px-5 fw-bold shadow-lg cta-btn-shine"
                                        style="color: #b71c1c; font-family: 'Plus Jakarta Sans', sans-serif;">
                                        Grab Yours üéÅ
                                    </span>
                                </div>
                                {% endif %}

                                <!-- Floating Decor -->
                                <div class="floating-decor"
                                    style="position: absolute; top: 10px; right: 20px; font-size: 4rem; opacity: 0.15; transform: rotate(15deg);">
                                    ‚ùÑÔ∏è</div>
                                <div class="floating-decor"
                                    style="position: absolute; bottom: 10px; right: 80px; font-size: 2.5rem; opacity: 0.15; transform: rotate(-10deg);">
                                    ü¶å</div>
                                <div class="floating-decor"
                                    style="position: absolute; bottom: 40px; right: 20px; font-size: 2rem; opacity: 0.2;">
                                    üéÑ</div>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <!-- Masonry Grid Layout (Premium Polish) -->
        <style>
            /* Bootstrap Grid Customization if needed */
            .product-col {
                display: flex;
            }

            .product-card {
                width: 100%;
                border-radius: 24px;
                overflow: hidden;
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                background: white;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.03);
                border: 1px solid rgba(0, 0, 0, 0.02);
                position: relative;
                display: flex;
                flex-direction: column;
            }

            .product-card:hover {
                transform: translateY(-8px) scale(1.01);
                box-shadow: 0 20px 40px rgba(212, 127, 166, 0.15);
                z-index: 10;
            }

            .glass-badge {
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                border: 1px solid rgba(255, 255, 255, 0.5);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            }

            /* Background Pattern */
            body {
                background-color: #fff5f8;
                background-image: radial-gradient(#ffccdb 1.5px, transparent 1.5px);
                background-size: 30px 30px;
                background-position: 0 0;
            }
        </style>

        <div class="row g-4">
            {% for product in products %}
            <!-- DEBUG BLOCK REMOVED -->
            <div class="col-6 col-md-4 col-xl-3 product-col">
                <a href="{% url 'product_detail' product.pk %}"
                    class="product-card d-block text-decoration-none bg-white shadow-sm"
                    style="border-radius: 20px; overflow: hidden; transition: transform 0.2s;">
                    <div class="position-relative">
                        <div class="product-img-container" style="overflow: hidden;">
                            {% if product.id == 31 or "santa" in product.name|lower %}
                            <img src="{% static 'images/santa_keychain.jpg' %}" class="w-100 d-block"
                                style="object-fit: cover; height: 100%; transition: transform 0.8s ease;"
                                onmouseover="this.style.transform='scale(1.05)'"
                                onmouseout="this.style.transform='scale(1)'" alt="{{ product.name }}">
                            {% elif product.image %}
                            <img src="{{ product.image.url }}" class="w-100 d-block"
                                style="object-fit: cover; height: 100%; transition: transform 0.8s ease;"
                                onmouseover="this.style.transform='scale(1.05)'"
                                onmouseout="this.style.transform='scale(1)'" alt="{{ product.name }}">
                            {% else %}
                            <div
                                class="d-flex align-items-center justify-content-center bg-light text-muted h-100 w-100">
                                <span class="fs-1">üß∂</span>
                            </div>
                            {% endif %}
                        </div>

                        <style>
                            .product-img-container {
                                height: 260px;
                            }

                            @media (max-width: 768px) {
                                .product-img-container {
                                    height: 190px;
                                }
                            }
                        </style>

                        <!-- Top Left Sparkle Badge -->
                        <div class="position-absolute top-0 start-0 m-2 px-2 py-1 rounded-pill shadow-sm"
                            style="background: linear-gradient(135deg, #a8e6cf, #dcedc1); font-size: 0.75rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            ‚ú®
                        </div>

                        <!-- Top Right Handmade Pill -->
                        <div class="position-absolute top-0 end-0 m-2 px-2 py-1 bg-white rounded-pill shadow-sm"
                            style="font-size: 0.65rem; color: #d63384; font-weight: bold; border: 1px solid #ffe4ec;">
                            Handmade üß∂
                        </div>

                        <!-- Vacation Overlay -->
                        {% if product.artisan.vacation_mode %}
                        <div class="position-absolute bottom-0 start-0 w-100 text-center py-2 bg-white bg-opacity-90"
                            style="border-top: 1px solid rgba(0,0,0,0.05);">
                            <span class="small fw-bold text-danger">üèñÔ∏è Artist on Vacation</span>
                        </div>
                        {% endif %}
                    </div>

                    <div class="p-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span class="text-uppercase fw-bold"
                                style="color: #ff99ac; font-size: 0.65rem; letter-spacing: 0.5px;">
                                {{ product.category.name|default:"General" }}
                            </span>
                            <small class="text-muted" style="font-size: 0.65rem;">
                                By {{ product.artisan.first_name|default:product.artisan.username }}
                            </small>
                        </div>

                        <h3 class="mb-2 text-dark"
                            style="font-family: 'Playfair Display', serif; font-weight: 700; font-size: 0.95rem; line-height: 1.3;">
                            {{ product.name|truncatechars:25 }}
                        </h3>

                        <div class="d-flex justify-content-between align-items-center mt-2">
                            <span class="fw-bold"
                                style="color: #d84a7e; font-size: 1.1rem; font-family: 'Plus Jakarta Sans', sans-serif;">
                                {% if product.id == 31 or "santa" in product.name|lower %}‚Çπ70.00{% else %}‚Çπ{{ product.price }}{% endif %}
                            </span>

                            <!-- Circular Add Button -->
                            <div class="rounded-circle d-flex align-items-center justify-content-center shadow-sm"
                                style="width: 28px; height: 28px; background-color: #fff0f5; color: #333;">
                                <span style="font-size: 1.1rem; line-height: 0; margin-top: -2px;">+</span>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <div style="font-size: 4rem; opacity: 0.5;">üß∂</div>
                <h3>No products found.</h3>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- TESTIMONIALS & INSTAGRAM (Trending Features) -->
<section class="py-5 bg-white">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Love Letters üíå</h2>
        </div>
        <div class="testimonial-scroller">
            {% for review in featured_reviews %}
            <div class="testimonial-card">
                <div class="mb-2">
                    {% for i in "12345"|make_list %}
                    {% if forloop.counter <= review.rating %}‚≠ê{% endif %} {% endfor %} </div>
                        <p class="mb-2 fst-italic">"{{ review.comment|truncatechars:80 }}"</p>
                        <small class="fw-bold">-
                            {% if review.customer_name %}
                            {{ review.customer_name }}
                            {% elif review.customer.get_display_name %}
                            {{ review.customer.get_display_name }}
                            {% else %}
                            Valued Customer
                            {% endif %}
                        </small>
                </div>
                {% empty %}
                <div class="testimonial-card">
                    <div class="mb-2">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="mb-2 fst-italic">"The crochet bouquet is absolutely beautiful! üå∏"</p>
                    <small class="fw-bold">- Priya S.</small>
                </div>
                <div class="testimonial-card">
                    <div class="mb-2">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="mb-2 fst-italic">"Got the Santa keychain, it's so adorable! üéÖ"</p>
                    <small class="fw-bold">- Anjali M.</small>
                </div>
                {% endfor %}
            </div>
        </div>
</section>

<section class="py-4">
    <div class="container-fluid p-0">
        <div class="text-center mb-4">
            <h5 class="fw-bold">
                <a href="https://www.instagram.com/_yarned.with.love_/" target="_blank"
                    class="text-decoration-none text-dark">
                    @yarned_with_love üì∏
                </a>
            </h5>
        </div>
        <div class="insta-grid">
            <div class="insta-item" style="background-color: #ffe4ec;">üß∂</div>
            <div class="insta-item" style="background-color: #fff0f5;">üßµ</div>
            <div class="insta-item" style="background-color: #e6e6fa;">üß£</div>
            <div class="insta-item" style="background-color: #ffe4e1;">üß§</div>
            <div class="insta-item" style="background-color: #f0fff0;">üß∏</div>
            <div class="insta-item" style="background-color: #fff5ee;">üéÄ</div>
        </div>
    </div>
</section>

<!-- NEWSLETTER -->
<section class="py-5"
    style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white;">
    <div class="container text-center">
        <h2 class="fw-bold mb-3">Join Our Knitting Circle üíå</h2>
        <p class="mb-4">Subscribe for updates on new drops!</p>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <form action="{% url 'subscribe' %}" method="POST">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="email" name="email" class="form-control border-0 rounded-start-pill py-3 px-4"
                            placeholder="Email Address" required>
                        <button type="submit" class="btn btn-dark rounded-end-pill px-4">Subscribe</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>



<style>
    .bottom-nav {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 85%;
        max-width: 350px;
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 50px;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        padding: 12px 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    }

    .nav-icon-3d {
        width: 32px;
        height: 32px;
        object-fit: contain;
        transition: transform 0.2s;
        filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
    }

    .nav-item:hover .nav-icon-3d {
        transform: scale(1.15) translateY(-2px);
    }

    .nav-item.active .nav-icon-3d {
        filter: drop-shadow(0 0 8px rgba(255, 105, 180, 0.4));
    }
</style>

<!-- BOTTOM NAV (Mobile Only) -->
<div class="bottom-nav">
    <a href="{% url 'product_list' %}" class="nav-item active">
        <img src="{% static 'icons/home.png' %}" alt="Home" class="nav-icon-3d">
    </a>
    <a href="#collection" class="nav-item">
        <img src="{% static 'icons/love.png' %}" alt="Love" class="nav-icon-3d">
    </a>
    <a href="{% url 'view_cart' %}" class="nav-item position-relative">
        <img src="{% static 'icons/cart.png' %}" alt="Cart" class="nav-icon-3d">
        {% if cart_count > 0 %}
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
            style="font-size: 0.5rem;">
            {{ cart_count }}
        </span>
        {% endif %}
    </a>
</div>

<script>
    // BEAUTIFUL SNOWFLAKE EFFECT ‚ùÑÔ∏è‚ú®
    function createSnowflake() {
        const snowflake = document.createElement('div');
        const isSparkle = Math.random() < 0.2; // 20% chance to be a sparkle
        snowflake.innerHTML = isSparkle ? '‚ú®' : '‚ùÑÔ∏è';

        snowflake.style.position = 'fixed';
        snowflake.style.top = '-50px';
        snowflake.style.left = Math.random() * 100 + 'vw';

        // Random size
        const size = Math.random() * 15 + 10;
        snowflake.style.fontSize = size + 'px';

        // Random opacity for depth
        snowflake.style.opacity = Math.random() * 0.7 + 0.3;

        // Random blur for depth of field effect
        if (Math.random() < 0.5) {
            snowflake.style.filter = `blur(${Math.random() * 2}px)`;
        }

        snowflake.style.zIndex = '9999';
        snowflake.style.pointerEvents = 'none';

        // Randomize fall duration
        const duration = Math.random() * 5 + 5;

        // Sway delay
        const swayDelay = Math.random() * 5;

        snowflake.style.animation = `fall ${duration}s linear infinite, sway ${Math.random() * 3 + 2}s ease-in-out infinite alternate`;
        snowflake.style.animationDelay = `0s, ${swayDelay}s`;

        // Add a soft glow
        snowflake.style.textShadow = '0 0 5px rgba(255, 255, 255, 0.8)';

        document.body.appendChild(snowflake);

        // Remove snowflake after animation
        setTimeout(() => {
            snowflake.remove();
        }, duration * 1000);
    }

    // Create snowflakes at intervals
    setInterval(createSnowflake, 200);

    // CSS for falling and swaying
    const style = document.createElement('style');
    style.innerHTML = `
        @keyframes fall {
            to {
                transform: translateY(110vh);
            }
        }
        @keyframes sway {
            from {
                margin-left: -20px;
                transform: rotate(0deg);
            }
            to {
                margin-left: 20px;
                transform: rotate(45deg);
            }
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}