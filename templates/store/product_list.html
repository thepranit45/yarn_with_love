{% extends 'base.html' %}
{% load static %}
{% block title %}Shop - Yarned with Love{% endblock %}

{% block content %}
<!-- INFINITE MARQUEE (Fixed & Seamless) -->
<div class="marquee-container">
    <div class="marquee-content">
        <span>âœ¨ Free Shipping on Orders Over â‚¹999! ğŸšš</span>
        <span>ğŸ€ Custom Orders Open for Wedding Season! ğŸ‘°</span>
        <span>ğŸ§¶ New Wool Blend Colors Available! ğŸŒˆ</span>
        <span>ğŸ’ Use Code WELCOME10 for 10% Off! ğŸ</span>
        <span>âœ¨ Free Shipping on Orders Over â‚¹999! ğŸšš</span>
        <span>ğŸ€ Custom Orders Open for Wedding Season! ğŸ‘°</span>
        <span>ğŸ§¶ New Wool Blend Colors Available! ğŸŒˆ</span>
        <span>ğŸ’ Use Code WELCOME10 for 10% Off! ğŸ</span>
    </div>
</div>

<!-- HERO SECTION (Playful Theme) -->
<section class="hero-section-new">
    <div class="hero-flower-top">ğŸ’</div>
    <div class="container position-relative z-2">
        <div class="row align-items-center justify-content-center text-center">
            <div class="col-lg-8 animate-fade-up">
                {% if user.is_authenticated %}
                <h3 class="mb-3" style="color: var(--primary-color);">Hello, {{ user.get_display_name }}! ğŸ‘‹</h3>
                {% endif %}
                <span class="hero-badge">ğŸ€ Handcrafted with Soul ğŸ€</span>
                <h1 class="hero-title-new">Weave Your Dreams <br><em>Into Reality.</em></h1>
                <p class="hero-subtitle mx-auto text-muted mb-4" style="max-width: 600px; font-size: 1.1rem;">
                    Discover our exclusive collection of bespoke crochet creations. <br>
                    Each stitch tells a story of love, patience, and artistry. ğŸ’
                </p>
                <div class="d-flex justify-content-center gap-3">
                    <a href="#collection" class="btn btn-main btn-lg">âœ¨ Explore Collection</a>
                    <a href="#categories" class="btn btn-outline-dark btn-lg rounded-pill">Browse Categories</a>
                </div>
            </div>
        </div>
    </div>
    <div class="hero-decoration-left">ğŸ€</div>
    <div class="hero-decoration-right">ğŸ§¶</div>
</section>

<!-- FEATURES SECTION -->
<section class="py-5">
    <div class="container">
        <div class="row g-4 text-center">
            <div class="col-md-4">
                <div class="feature-card">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸŒ¿</div>
                    <h3 class="h5 fw-bold" style="color: var(--primary-color);">Eco-Friendly Materials</h3>
                    <p class="text-muted small">We use only sustainable, skin-friendly yarns for our creations.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ–ï¸</div>
                    <h3 class="h5 fw-bold" style="color: var(--primary-color);">100% Handmade</h3>
                    <p class="text-muted small">Every item is crafted by hand, ensuring uniqueness and quality.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ’</div>
                    <h3 class="h5 fw-bold" style="color: var(--primary-color);">Customizable</h3>
                    <p class="text-muted small">Personalize your orders to make the perfect gift for loved ones.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CATEGORIES SECTION (Premium Polish) -->
<section id="categories" class="py-5 bg-white">
    <div class="container">
        <div class="text-center mb-4">
            <h2 class="display-6 fw-bold" style="color: var(--text-dark); font-family: 'Playfair Display', serif;">
                Browse by Category</h2>
            <p class="text-muted">Find exactly what you're looking for!</p>
        </div>

        <div class="d-flex flex-wrap justify-content-center gap-3">
            <a href="?#collection"
                class="btn btn-lg rounded-pill px-4 py-2 shadow-sm {% if not request.GET.category %}active-category{% endif %}"
                style="background-color: var(--primary-color); color: white; border: none; transition: all 0.3s ease;">
                All âœ¨
            </a>

            {% if categories %}
            {% for category in categories %}
            <a href="?category={{ category.slug }}#collection"
                class="btn btn-lg rounded-pill px-4 py-2 shadow-sm d-flex align-items-center gap-2 category-pill"
                style="background-color: #fff0f5; color: var(--text-dark); border: 1px solid rgba(0,0,0,0.05); transition: all 0.3s ease;">
                <span style="font-size: 1.2rem;">
                    {% if 'toy' in category.name|lower %}ğŸ§¸
                    {% elif 'hair' in category.name|lower %}ğŸ€
                    {% elif 'pot' in category.name|lower %}ğŸŒ»
                    {% elif 'key' in category.name|lower %}ğŸ”‘
                    {% elif 'cloth' in category.name|lower or 'wear' in category.name|lower %}ğŸ‘—
                    {% elif 'bag' in category.name|lower %}ğŸ‘œ
                    {% elif 'home' in category.name|lower or 'decor' in category.name|lower %}ğŸ 
                    {% elif 'flower' in category.name|lower %}ğŸŒ¹
                    {% else %}ğŸ§¶{% endif %}
                </span>
                <span style="font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 600;">{{ category.name }}</span>
            </a>
            {% endfor %}
            {% endif %}
        </div>

        <style>
            .category-pill:hover {
                transform: translateY(-3px);
                background-color: white !important;
                box-shadow: 0 10px 20px rgba(212, 127, 166, 0.2) !important;
                border-color: var(--primary-color) !important;
                color: var(--primary-color) !important;
            }

            .active-category {
                background: var(--primary-color) !important;
                color: white !important;
                box-shadow: 0 10px 20px rgba(212, 127, 166, 0.3) !important;
            }
        </style>
    </div>
</section>

<!-- RECOMMENDED SECTION -->
{% if recommended_products %}
<section class="py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-6 fw-bold" style="color: var(--primary-color);">Recommended For You ğŸ’–</h2>
            <p class="text-muted">Because you have great taste!</p>
            <div class="section-divider"></div>
        </div>
        <div class="row g-4">
            {% for product in recommended_products %}
            <div class="col-6 col-md-3">
                <a href="{% url 'product_detail' product.pk %}" class="product-card">
                    <div class="product-img-wrapper">
                        {% if product.image %}
                        <img src="{{ product.image.url }}" class="product-img" alt="{{ product.name }}">
                        {% else %}
                        <div class="product-img d-flex align-items-center justify-content-center text-muted">No Image
                        </div>
                        {% endif %}
                    </div>
                    <div class="product-info">
                        <h3 class="product-title mb-1" style="font-size: 1rem; font-weight: 600;">{{ product.name }}
                        </h3>
                        <p class="text-muted small mb-0">{{ product.category.name|default:"General" }}</p>
                        <span class="product-price small">â‚¹{{ product.price }}</span>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- COLLECTION SECTION -->
<section id="collection" class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            {% if query %}
            <h2 class="display-5 fw-bold" style="color: var(--text-dark);">Search Results for "{{ query }}"</h2>
            <a href="{% url 'product_list' %}" class="btn btn-sm btn-outline-dark mt-2">Clear Search</a>
            {% else %}
            <h2 class="display-5 fw-bold" style="color: var(--text-dark);">Our Lovely Collection</h2>
            <p class="text-muted">Handpicked treasures just for you âœ¨</p>
            {% endif %}
            <div class="section-divider"></div>
        </div>

        <!-- Masonry Grid Layout (Premium Polish) -->
        <style>
            /* Bootstrap Grid Customization if needed */
            .product-col {
                display: flex;
            }

            .product-card {
                width: 100%;
                border-radius: 24px;
                overflow: hidden;
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                background: white;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.03);
                border: 1px solid rgba(0, 0, 0, 0.02);
                position: relative;
                display: flex;
                flex-direction: column;
            }

            .product-card:hover {
                transform: translateY(-8px) scale(1.01);
                box-shadow: 0 20px 40px rgba(212, 127, 166, 0.15);
                z-index: 10;
            }

            .glass-badge {
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                border: 1px solid rgba(255, 255, 255, 0.5);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            }

            /* Background Pattern */
            body {
                background-color: #fff5f8;
                background-image: radial-gradient(#ffccdb 1.5px, transparent 1.5px);
                background-size: 30px 30px;
                background-position: 0 0;
            }
        </style>

        <div class="row g-4">
            {% for product in products %}
            <!-- DEBUG BLOCK REMOVED -->
            <div class="col-12 col-sm-6 col-md-4 col-xl-3 product-col">
                <a href="{% url 'product_detail' product.pk %}"
                    class="product-card d-block text-decoration-none text-dark">
                    <div class="position-relative">
                        {% if product.image %}
                        <!-- Image with natural height & subtle zoom effect on parent hover -->
                        <div style="overflow: hidden;">
                            <img src="{{ product.image.url }}" class="w-100 d-block"
                                style="object-fit: cover; transition: transform 0.8s ease;"
                                onmouseover="this.style.transform='scale(1.05)'"
                                onmouseout="this.style.transform='scale(1)'" alt="{{ product.name }}">
                        </div>
                        {% else %}
                        <div class="d-flex align-items-center justify-content-center bg-light text-muted"
                            style="height: 250px;">
                            <span class="fs-1">ğŸ§¶</span>
                        </div>
                        {% endif %}

                        <!-- Badges -->
                        {% if product.estimated_days_to_complete <= 3 %} <span
                            class="badge position-absolute top-0 start-0 m-3 px-3 py-2 rounded-pill shadow-sm"
                            style="background: linear-gradient(135deg, #a8e6cf, #dcedc1); color: #1a5e3a; font-weight: 600; font-size: 0.75rem;">
                            âœ¨ Ready Soon
                            </span>
                            {% endif %}

                            <!-- Watermark -->
                            <div class="glass-badge position-absolute top-0 end-0 m-3 px-3 py-1 rounded-pill"
                                style="border: 1px solid #ffe4ec;">
                                <small class="fw-bold" style="font-size: 0.7rem; color: var(--primary-color);">Handmade
                                    ğŸ§¶</small>
                            </div>

                            <!-- Vacation Overlay -->
                            {% if product.artisan.vacation_mode %}
                            <div class="position-absolute bottom-0 start-0 w-100 text-center py-2 glass-badge"
                                style="border-radius: 0; border-top: 1px solid rgba(0,0,0,0.05);">
                                <span class="small fw-bold text-danger">ğŸ–ï¸ Artist on Vacation</span>
                            </div>
                            {% endif %}
                    </div>

                    <div class="p-4">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <p class="text-uppercase tracking-wider small fw-bold mb-0"
                                style="color: var(--secondary-color); font-size: 0.7rem; letter-spacing: 1px;">
                                {{ product.category.name|default:"General" }}
                            </p>
                            <small class="text-muted" style="font-size: 0.75rem;">
                                By {{ product.artisan.first_name|default:product.artisan.username }}
                            </small>
                        </div>

                        <h3 class="h5 fw-bold mb-3"
                            style="font-family: 'Playfair Display', serif; letter-spacing: -0.5px;">
                            {{ product.name }}
                        </h3>

                        <div class="d-flex justify-content-between align-items-center pt-3 border-top border-light">
                            <span class="fw-bold" style="color: var(--primary-color); font-size: 1.2rem;">
                                <span>â‚¹</span>{{ product.price }}
                            </span>
                            <span class="btn btn-sm rounded-pill px-3"
                                style="background-color: var(--bg-light); color: var(--text-dark); border: 1px solid #ffe4ec; transition: 0.2s;">
                                View âœ
                            </span>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <div style="font-size: 4rem; opacity: 0.5;">ğŸ§¶</div>
                <h3>No products found.</h3>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- TESTIMONIALS & INSTAGRAM (Trending Features) -->
<section class="py-5 bg-white">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Love Letters ğŸ’Œ</h2>
        </div>
        <div class="testimonial-scroller">
            {% for review in featured_reviews %}
            <div class="testimonial-card">
                <div class="mb-2">
                    {% for i in "12345"|make_list %}
                    {% if forloop.counter <= review.rating %}â­{% endif %} {% endfor %} </div>
                        <p class="mb-2 fst-italic">"{{ review.comment|truncatechars:80 }}"</p>
                        <small class="fw-bold">-
                            {% if review.customer_name %}
                            {{ review.customer_name }}
                            {% elif review.customer.get_display_name %}
                            {{ review.customer.get_display_name }}
                            {% else %}
                            Valued Customer
                            {% endif %}
                        </small>
                </div>
                {% empty %}
                <div class="testimonial-card">
                    <div class="mb-2">â­â­â­â­â­</div>
                    <p class="mb-2 fst-italic">"The most beautiful sweater I own!"</p>
                    <small class="fw-bold">- Priya S.</small>
                </div>
                <div class="testimonial-card">
                    <div class="mb-2">â­â­â­â­â­</div>
                    <p class="mb-2 fst-italic">"Packaging was so cute! ğŸ€"</p>
                    <small class="fw-bold">- Anjali M.</small>
                </div>
                {% endfor %}
            </div>
        </div>
</section>

<section class="py-4">
    <div class="container-fluid p-0">
        <div class="text-center mb-4">
            <h5 class="fw-bold">
                <a href="https://www.instagram.com/_yarned.with.love_/" target="_blank"
                    class="text-decoration-none text-dark">
                    @yarned_with_love ğŸ“¸
                </a>
            </h5>
        </div>
        <div class="insta-grid">
            <div class="insta-item" style="background-color: #ffe4ec;">ğŸ§¶</div>
            <div class="insta-item" style="background-color: #fff0f5;">ğŸ§µ</div>
            <div class="insta-item" style="background-color: #e6e6fa;">ğŸ§£</div>
            <div class="insta-item" style="background-color: #ffe4e1;">ğŸ§¤</div>
            <div class="insta-item" style="background-color: #f0fff0;">ğŸ§¸</div>
            <div class="insta-item" style="background-color: #fff5ee;">ğŸ€</div>
        </div>
    </div>
</section>

<!-- NEWSLETTER -->
<section class="py-5"
    style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white;">
    <div class="container text-center">
        <h2 class="fw-bold mb-3">Join Our Knitting Circle ğŸ’Œ</h2>
        <p class="mb-4">Subscribe for updates on new drops!</p>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <form action="{% url 'subscribe' %}" method="POST">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="email" name="email" class="form-control border-0 rounded-start-pill py-3 px-4"
                            placeholder="Email Address" required>
                        <button type="submit" class="btn btn-dark rounded-end-pill px-4">Subscribe</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<a href="#" class="floating-chat-btn">ğŸ’¬</a>
{% endblock %}